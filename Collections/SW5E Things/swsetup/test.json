{
  "name": "Projected Barrier - Environmental Barrier",
  "_v": 2,
  "activation_type": 3,
  "verb": "uses",
  "automation": [
    {
      "type": "variable",
      "value": "{caster.levels.get('Engineer')}",
      "name": "level"
    },
    {
      "type": "variable",
      "value": "4 if level < 5 else 6 if level < 9 else 8 if level < 13 else 10 if level < 17 else 12",
      "name": "die"
    },
    {
      "type": "condition",
      "condition": "choice and any(x in 'acidcoldfireforcelightningnecroticpoisonpsychicsonic' for x in choice.split(','))",
      "onTrue": [
        {
          "type": "text",
          "text": "here"
        }
      ],
      "onFalse": []
    },
    {
      "type": "condition",
      "condition": "choice and (choice.split(',')[0] in 'acidcoldfireforcelightningnecroticpoisonpsychicsonic' or (len(choice.split(','))>1 and choice.split(',')[1] in 'acidcoldfireforcelightningnecroticpoisonpsychicsonic'))",
      "onTrue": [
        {
          "type": "roll",
          "dice": "{2 if choice and 'gott' in choice.split(',') else 1}d{die}+{level}",
          "name": "barrierAmt"
        },
        {
          "type": "target",
          "target": "each",
          "effects": [
            {
              "type": "ieffect2",
              "name": "Environmental Barrier",
              "duration": 100,
              "desc": "The creature can roll the die and add the number rolled to one ability check, attack roll, or saving throw it makes. Once the Potent Aptitude die is rolled, it is lost.\n{2 if choice == 'gott' else 1}d{die}",
              "buttons": [
                {
                  "label": "Use Potent Aptitude",
                  "verb": "is using assistance",
                  "style": 3,
                  "automation": [
                    {
                      "type": "remove_ieffect"
                    },
                    {
                      "type": "roll",
                      "dice": "{ieffect.desc.split()[-1]}",
                      "name": "Potent Aptitude"
                    },
                    {
                      "type": "text",
                      "text": "The creature can roll the die and add the number rolled to one ability check, attack roll, or saving throw it makes. Once the Potent Aptitude die is rolled, it is lost."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "text",
          "text": "As a bonus action while wearing your gadgeteer harness, you can expend a use of your Potent Aptitude to project a barrier on a friendly creature you can see within 30 feet. A creature can only have one barrier active at a time.",
          "title": "Projected Barrier"
        },
        {
          "type": "text",
          "title": "Environmental Barrier",
          "text": "You project an environmental barrier that lasts until the end of your next short or long rest. The barrier has a number of hit points equal to the amount rolled on your Potent Aptitude die + your engineer level. Whenever a creature with this barrier takes damage (one of acid, cold, fire, force, lightning, necrotic, poison, psychic, or sonic, chosen by you when you activate the effect), the barrier takes the damage instead. If this damage reduces the barrier to 0 hit points, the creature take any remaining damage."
        },
        {
          "type": "counter",
          "counter": "Potent Aptitude",
          "amount": 1,
          "errorBehaviour": "raise"
        },
        {
          "type": "condition",
          "condition": "choice == 'gott'",
          "onFalse": [],
          "onTrue": [
            {
              "type": "counter",
              "counter": "Goggles of the Tinkerer",
              "amount": 1,
              "errorBehaviour": "raise"
            },
            {
              "type": "text",
              "text": "Once per turn, when you use a Potent Aptitude feature, you can spend 1 charge to roll the Potent Aptitude dice twice and add them together.",
              "title": "Goggles of the Tinkerer"
            }
          ]
        }
      ],
      "onFalse": [
        {
          "type": "text",
          "text": "Please use `-choice` to specify the damage type the barrier protects against.\nIf using Goggles of the Tinkerer use `-choice gott,<element>` or `-choice <element>,gott`"
        }
      ]
    }
  ]
}