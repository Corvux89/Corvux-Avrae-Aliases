{
  "name": "Telekinetic Shield",
  "level": 3,
  "school": "Force",
  "classes": "Universal",
  "subclasses": "",
  "casttime": "1 action",
  "range": "Self",
  "components": {
    "verbal": false,
    "somatic": false,
    "material": ""
  },
  "duration": "up to 1 minute",
  "ritual": false,
  "description": "You lift three piles of debris or small objects from the ground and interpose them between you and your opponents for the duration. \r\n\r\nWhile at least three piles remain, you have three-quarters cover. While two piles remain, you have half cover. While only one pile remains, you have one-quarter cover. The piles don't hinder your attacks. When you cast the power, or as an action on a subsequent turn, you can direct up to two piles to attack up to two creatures you can see within 30 feet. Make a ranged force attack roll for each pile. On a hit, a creature takes 2d6 kinetic plus 1d10 force damage. The pile is destroyed whether it hits or misses.\r\n\r\n***Force Potency.*** If you cast this power with a force slot of 4th level or higher, the power creates one additional pile for each level above 3rd.",
  "concentration": true,
  "automation": [
    {
      "type": "variable",
      "name": "numPiles",
      "value": "3",
      "higher": {
        "4": "4",
        "5": "5",
        "6": "6",
        "7": "7",
        "8": "8",
        "9": "9"
      }
    },
    {
      "type": "target",
      "target": "self",
      "effects": [
        {
          "type": "ieffect2",
          "name": "Debris Piles",
          "desc": "{numPiles}",
          "save_as": "peff",
          "parent": "ieffect",
          "attacks": [
            {
              "attack": {
                "name": "Telekinetic Shield - Fire Pile",
                "_v": 2,
                "automation": [
                  {
                    "type": "variable",
                    "name": "numPiles",
                    "value": "int(ieffect.desc.split()[-1])-(max(len(ieffect.children)-1,0))-len(targets)"
                  },
                  {
                    "type": "condition",
                    "condition": "numPiles < 0",
                    "onTrue": [
                      {
                        "type": "text",
                        "text": "Not enough stacks remaining to attack {len(targets)} targets."
                      }
                    ],
                    "onFalse": [
                      {
                        "type": "target",
                        "target": "each",
                        "effects": [
                          {
                            "type": "attack",
                            "miss": [],
                            "hit": [
                              {
                                "type": "damage",
                                "damage": "2d6 [kinetic] + 1d10 [force]"
                              },
                              {
                                "type": "ieffect2",
                                "name": "Debris Piles",
                                "stacking": true,
                                "target_self": true,
                                "parent": "ieffect"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "target",
                        "target": "self",
                        "effects": [
                          {
                            "type": "condition",
                            "condition": "numPiles >= 3",
                            "onTrue": [
                              {
                                "type": "ieffect2",
                                "name": "Telekinetic Shield - Cover",
                                "desc": "A target with three-quarters cover has a +5 bonus to AC and Dexterity saving throws. A target has three-quarter cover if about three-quarters of it is obstructed, whether by an obstacle or a creature of one size category larger.",
                                "parent": "ieffect",
                                "effects": {
                                  "ac_bonus": 5
                                }
                              }
                            ],
                            "onFalse": [
                              {
                                "type": "condition",
                                "condition": "numPiles == 2",
                                "onTrue": [
                                  {
                                    "type": "ieffect2",
                                    "name": "Telekinetic Shield - Cover",
                                    "desc": "A target with half cover has a +3 bonus to AC and Dexterity saving throws. A target has half cover if an obstacle blocks at least half of its body, such as a low wall or a creature of the same size category.",
                                    "parent": "ieffect",
                                    "effects": {
                                      "ac_bonus": 3
                                    }
                                  }
                                ],
                                "onFalse": [
                                  {
                                    "type": "ieffect2",
                                    "name": "Telekinetic Shield - Cover",
                                    "desc": "A target with one-quarter cover has a +2 bonus to AC and Dexterity saving throws. A target has one-quarter cover if an obstacle blocks at least one-fourth of its body, such as a thin pillar or a creature of one size category smaller.",
                                    "parent": "ieffect",
                                    "effects": {
                                      "ac_bonus": 2
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
      "type": "text",
      "text": "***# of Piles***: {numPiles}"
    }
                    ]
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "ieffect2",
          "name": "Telekinetic Shield - Cover",
          "desc": "A target with three-quarters cover has a +5 bonus to AC and Dexterity saving throws. A target has three-quarter cover if about three-quarters of it is obstructed, whether by an obstacle or a creature of one size category larger.",
          "parent": "peff",
          "effects": {
            "ac_bonus": 5
          }
        },
        {
      "type": "text",
      "text": "***# of Piles***: {numPiles}"
    }
      ]
    },
    {
      "type": "text",
      "text": "You lift three piles of debris or small objects from the ground and interpose them between you and your opponents for the duration. \n\nWhile at least three piles remain, you have three-quarters cover. While two piles remain, you have half cover. While only one pile remains, you have one-quarter cover. The piles don't hinder your attacks. When you cast the power, or as an action on a subsequent turn, you can direct up to two piles to attack up to two creatures you can see within 30 feet. Make a ranged force attack roll for each pile. On a hit, a creature takes 2d6 kinetic plus 1d10 force damage. The pile is destroyed whether it hits or misses.\n\n***Force Potency.*** If you cast this power with a force slot of 4th level or higher, the power creates one additional pile for each level above 3rd."
    },
    {
      "type": "text",
      "text": "***# of Piles***: {numPiles}"
    }
  ]
}